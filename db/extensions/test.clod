# vim: ft=coffee

object $sys

method lookup_obj_name
  using toobj
  args name

  toobj name

method loaded
  using $test
  vars parent_sys, module
  args mod

  module     = mod
  parent_sys = module.toobj '$sys'

  @copy_parent_methods()
  @run_tests()

method copy_parent_methods
  vars parent_sys, module
  
  exposed_methods =
    module.request_methods,
      sys:  [/.*/]
      root: [/.*/]

  for obj in ['sys', 'root']
    for name, method of exposed_methods[obj]
      parent_sys.add_method toobj("$" + obj), name, method

method run_tests
  for test in @descendents()
    [test.root_name(), test.run()]


object $test

method run
  using send

  for method_name in send @list_methods
    if method_name.startsWith 'test_'
      try
        result = send @[method_name]
      catch e
        result = e

      [method_name, result]

default_parent $test

object $test_testing

method test_testing
  true

